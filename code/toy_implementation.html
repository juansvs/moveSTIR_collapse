<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Juan Vargas">

<title>building intuition for pmovestir</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="toy_implementation_files/libs/clipboard/clipboard.min.js"></script>
<script src="toy_implementation_files/libs/quarto-html/quarto.js"></script>
<script src="toy_implementation_files/libs/quarto-html/popper.min.js"></script>
<script src="toy_implementation_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="toy_implementation_files/libs/quarto-html/anchor.min.js"></script>
<link href="toy_implementation_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="toy_implementation_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="toy_implementation_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="toy_implementation_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="toy_implementation_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">building intuition for pmovestir</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Juan Vargas </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>The stationary distribution version of probabilistic MoveSTIR is described by the following equation:</p>
<p><span class="math display">\[
E[h_{i\leftarrow j}(x)]=\beta\lambda\left[p_i(x)p_j(x)\frac{1}{\nu}+\sigma[\delta_i(x)]\sigma[\delta_j(x)]\int_0^\infty \rho[\delta_i(x),\delta_j(x)] e^{-\nu s}ds\right]
\]</span></p>
<p>Briefly, the force of infection experienced by individual <span class="math inline">\(i\)</span> from individual <span class="math inline">\(j\)</span> is proportional to two main terms</p>
<ol type="1">
<li>The product of the utilization distributions of both individuals. This is, the probabilities of using a given location. We assume this probability is stable through time.</li>
<li>The temporal cross-correlation in use of a given location. This is, the correlations between the presence of each individual at the same cell, integrated across all possible lags. This term accounts for the possibility of using the same areas, but with some lag between visits. Visits that are further apart in time will have a lower influence on the force of infection, given the decay of the parasite in the environment.</li>
</ol>
<p>The way I’ve been approaching this has been to</p>
<ol type="1">
<li>Simulate tracking data</li>
<li>Fit a continuous time movement model to the simulated tracks, and generate the autocorrelated kernel density estimate of the utilization distribution. The generated UDs can be expressed in terms of a probability <em>mass</em> or a probability <em>density.</em></li>
<li>Estimate the probability distribution of encounters. This is the product of two utilization distributions, divided by the coefficient of overlap (Scharf et al.&nbsp;2018).</li>
<li>Calculate the pairwise product of the utilization distributions, and the product of their standard deviations. The standard deviations are calculated as <span class="math inline">\(\sigma_i=\sqrt{\hat p_i(1-\hat p_i)}\)</span>, where <span class="math inline">\(\hat p_i\)</span> is the estimated probability of use from the UD. Both products have been at the spatial scale generated by the kernel density estimation process.</li>
<li>Sample random points within the 95% polygon of the contact probability distribution.</li>
<li>Determine the visit history for both individuals inside a square around each random point. The side of the square is two times a threshold distance that determine contact. The visit history is a binary vector that tells whether an individual was inside the square, for all time points.</li>
<li>Determine the cross-correlation between the visit histories at every point, i.e.&nbsp;the correlation for every possible lag. Multiply this cross-correlation values by a corresponding scaling factor equal to <span class="math inline">\(e^{-\nu\tau}\)</span> , where <span class="math inline">\(\nu\)</span> is the decay rate of the parasite in the environment and <span class="math inline">\(\tau\)</span> is the lag.</li>
<li>Add the cross-correlations multiplied by the scaling factors together, and multiply them by the product of standard deviations at that same location.</li>
<li>Add the result to the product of the UDs, and scale them by the epidemiological parameters.</li>
</ol>
<p>Now, there could be a mismatch between scales. I’ve been using the grid generated by the akde algorithm to generate the product of the UDs and the standard deviations. The sampling area of the random points, in contrast, is defined by the contact distance, which is related to the epidemiological process. The risk here is that the correlations do not correspond well with the resolution of the grid.</p>
<p>Most terms in the equation are unitless: the probabilities, their standard deviations, the correlations, the scalar in the integral. So how do we determine the right process? To get some intuition, I will generate data in a simpler way, and follow a similar process.</p>
<p>So first let’s set a landscape with certain probabilities of use. I will generate a simple 6 by 6 grid, which can then be sampled as a 3 by 3 grid, and compare the results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>ncells <span class="ot">&lt;-</span> <span class="dv">6</span><span class="sc">*</span><span class="dv">6</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>trueprobs <span class="ot">&lt;-</span> <span class="fu">runif</span>(ncells)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="fu">matrix</span>(trueprobs<span class="sc">/</span><span class="fu">sum</span>(trueprobs), <span class="at">nrow =</span> <span class="dv">6</span>), <span class="at">asp=</span><span class="dv">1</span>,<span class="at">las=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="toy_implementation_files/figure-html/true-ud-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Then we generate two location histories, where the locations are determined by the probabilities of use.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>nsteps <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pos1 <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(ncells, <span class="at">size =</span> nsteps, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> trueprobs)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>pos2 <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(ncells, <span class="at">size =</span> nsteps, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> trueprobs)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>dethist1 <span class="ot">&lt;-</span> dethist2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nsteps, <span class="at">ncol =</span> ncells)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(nsteps)) {</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> pos1[i]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  p2 <span class="ot">&lt;-</span> pos2[i]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  dethist1[i,p1] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  dethist2[i,p2] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="dv">1</span><span class="sc">:</span>nsteps, <span class="dv">1</span><span class="sc">:</span>ncells, dethist1, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Location"</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="dv">1</span><span class="sc">:</span>nsteps, <span class="dv">1</span><span class="sc">:</span>ncells, dethist2, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">""</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="at">outer =</span> T, <span class="at">text =</span> <span class="st">"Detection histories"</span>,<span class="at">line =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">cex =</span> <span class="fl">1.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="toy_implementation_files/figure-html/loc-hists-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the detection histories we can estimate a probability of use as the proportion of times the individuals used a given cell. These estimated probabilities correspond to the probability mass function, i.e.&nbsp;the integral of the probability density function across each cell, and their values sum to 1. The corresponding PDF would be obtained dividing the probabilities by the area of each cell (1 in this case).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>est_probs1 <span class="ot">&lt;-</span> est_probs2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,ncells)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>est_probs1[<span class="fu">as.numeric</span>(<span class="fu">names</span>(<span class="fu">table</span>(pos1)))] <span class="ot">&lt;-</span> <span class="fu">table</span>(pos1)<span class="sc">/</span>nsteps</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>est_probs2[<span class="fu">as.numeric</span>(<span class="fu">names</span>(<span class="fu">table</span>(pos2)))] <span class="ot">&lt;-</span> <span class="fu">table</span>(pos2)<span class="sc">/</span>nsteps</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,<span class="fu">matrix</span>(trueprobs, <span class="at">ncol =</span> <span class="dv">6</span>), <span class="at">asp=</span><span class="dv">1</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"True prob"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,<span class="fu">matrix</span>(est_probs1, <span class="at">ncol=</span><span class="dv">6</span>), <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Est prob 1"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,<span class="fu">matrix</span>(est_probs2, <span class="at">ncol=</span><span class="dv">6</span>), <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Est prob 2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="toy_implementation_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We then use these estimated probabilities to calculate the product of the utilization distributions, and the product of the standard deviations. The first terms represent the probability of contact in a given cell, based on the individual pattern of space use. The second term accounts for variability in space use.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>udprod <span class="ot">&lt;-</span> est_probs1<span class="sc">*</span>est_probs2</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>sdprod <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(est_probs1<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>est_probs1))<span class="sc">*</span><span class="fu">sqrt</span>(est_probs2<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>est_probs2))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="fu">matrix</span>(udprod, <span class="at">ncol =</span> <span class="dv">6</span>), <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"UD prod"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="fu">matrix</span>(sdprod, <span class="at">ncol =</span> <span class="dv">6</span>), <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"StDev prod"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="toy_implementation_files/figure-html/udprod-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We then calculate the cross-correlation between the location histories. The ccf function calculates these cross-correlations for all lags, positive and negative. These correlations are based on some contact distance. In the grid approach, we assume that the grid resolution accurately represents the epidemiological contact distance. This is, a maximum distance beyond which animals are not likely to transmit disease to one another. Most parasite environmental stages can be considered stationary with respect to their hosts movement, so this distance is entirely determined by the movement of the host.</p>
<p>The cross-correlation is unitless, but it is linked to a specific spatial resolution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>xcors <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(dethist1), \(i) <span class="fu">ccf</span>(dethist1[,i], dethist2[,i], <span class="at">plot =</span> F, <span class="at">lag.max =</span> <span class="dv">20-1</span>)) </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>xcors_vals <span class="ot">&lt;-</span> <span class="fu">sapply</span>(xcors, <span class="st">"[["</span>, <span class="st">"acf"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>xcors_lags <span class="ot">&lt;-</span> <span class="fu">sapply</span>(xcors, <span class="st">"[["</span>, <span class="st">"lag"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Calculate the cell covariance: scale the correlation values by the decay rate and multiply by the sd product.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>corrint_ij <span class="ot">&lt;-</span> <span class="fu">colSums</span>((xcors_vals<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>nu<span class="sc">*</span><span class="fu">abs</span>(xcors_lags)))[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,])</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>corrint_ji <span class="ot">&lt;-</span> <span class="fu">colSums</span>((xcors_vals<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>nu<span class="sc">*</span><span class="fu">abs</span>(xcors_lags)))[<span class="dv">20</span><span class="sc">:</span><span class="dv">39</span>,])</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>corrint_ij <span class="ot">&lt;-</span> <span class="fu">replace</span>(corrint_ij, <span class="fu">is.nan</span>(corrint_ij), <span class="dv">0</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>corrint_ji <span class="ot">&lt;-</span> <span class="fu">replace</span>(corrint_ji, <span class="fu">is.nan</span>(corrint_ji), <span class="dv">0</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># par(mfrow = c(1,2))</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># image(matrix(corrint_ij, ncol = 6), las = 1, asp = 1, main = "Integral, i-&gt;j", col = hcl.colors(7, "Blue-Red", rev=T),</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#       zlim = c(-max(abs(range(corrint_ij))),max(abs(range(corrint_ij)))))</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># image(matrix(corrint_ji, ncol = 6), las = 1, asp = 1, main = "Integral, j-&gt;i", col = hcl.colors(7, "Blue-Red", rev = T),</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#       zlim = c(-max(abs(range(corrint_ji))),max(abs(range(corrint_ji)))))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then add the product of the UDs to the covariance term to obtain the FOI. For simplicity we assume <span class="math inline">\(\beta=\lambda=1\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>foi_ij <span class="ot">&lt;-</span> udprod<span class="sc">/</span>nu<span class="sc">+</span>sdprod<span class="sc">*</span>corrint_ij</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>foi_ji <span class="ot">&lt;-</span> udprod<span class="sc">/</span>nu<span class="sc">+</span>sdprod<span class="sc">*</span>corrint_ji</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># par(mfrow = c(1,2))</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># image(matrix((foi_ij-min(foi_ij))/diff(range(foi_ij)), ncol = 6), las = 1, asp = 1, main = "FOI, i-&gt;j")</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># image(matrix((foi_ji-min(foi_ji))/diff(range(foi_ji)), ncol = 6), las = 1, asp = 1, main = "FOI, j-&gt;i")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hare are the estimated force of infection values for <span class="math inline">\(i\)</span> from <span class="math inline">\(j\)</span>, and <em>vice versa</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sum</span>(foi_ij[foi_ij<span class="sc">&gt;=</span><span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.04862688</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sum</span>(foi_ji[foi_ji<span class="sc">&gt;=</span><span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06122299</code></pre>
</div>
</div>
<p>Now we want to see what happens when we increase the scale, when we take larger grid cells to estimate use and correlation. First we define the new grid, each new cell will contain four of the smaller cells.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ncells2 <span class="ot">&lt;-</span> <span class="dv">9</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>pos1l <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">9</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">9</span>)[pos1]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>pos2l <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">9</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">9</span>)[pos2]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>dethist1l <span class="ot">&lt;-</span> dethist2l <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nsteps, <span class="at">ncol =</span> ncells2)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(nsteps)) {</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> pos1l[i]</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  p2 <span class="ot">&lt;-</span> pos2l[i]</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  dethist1l[i,p1] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  dethist2l[i,p2] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>est_probs1 <span class="ot">&lt;-</span> est_probs2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,ncells2)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>est_probs1[<span class="fu">as.numeric</span>(<span class="fu">names</span>(<span class="fu">table</span>(pos1l)))] <span class="ot">&lt;-</span> <span class="fu">table</span>(pos1l)<span class="sc">/</span>nsteps</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>est_probs2[<span class="fu">as.numeric</span>(<span class="fu">names</span>(<span class="fu">table</span>(pos2l)))] <span class="ot">&lt;-</span> <span class="fu">table</span>(pos2l)<span class="sc">/</span>nsteps</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>udprodl <span class="ot">&lt;-</span> est_probs1<span class="sc">*</span>est_probs2</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>sdprodl <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(est_probs1<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>est_probs1))<span class="sc">*</span><span class="fu">sqrt</span>(est_probs2<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>est_probs2))</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">matrix</span>(udprodl, <span class="at">ncol =</span> <span class="dv">3</span>), <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"UD prod"</span>)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">matrix</span>(sdprodl, <span class="at">ncol =</span> <span class="dv">3</span>), <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"StDev prod"</span>)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="fu">matrix</span>(udprod, <span class="at">ncol =</span> <span class="dv">6</span>), <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"UD prod"</span>)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="fu">matrix</span>(sdprod, <span class="at">ncol =</span> <span class="dv">6</span>), <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"StDev prod"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="toy_implementation_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>xcors <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(dethist1l), \(i) <span class="fu">ccf</span>(dethist1l[,i], dethist2l[,i], <span class="at">plot =</span> F, <span class="at">lag.max =</span> <span class="dv">20-1</span>)) </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>xcors_vals <span class="ot">&lt;-</span> <span class="fu">sapply</span>(xcors, <span class="st">"[["</span>, <span class="st">"acf"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>xcors_lags <span class="ot">&lt;-</span> <span class="fu">sapply</span>(xcors, <span class="st">"[["</span>, <span class="st">"lag"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>corrint_ijl <span class="ot">&lt;-</span> <span class="fu">colSums</span>((xcors_vals<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>nu<span class="sc">*</span><span class="fu">abs</span>(xcors_lags)))[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,])</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>corrint_jil <span class="ot">&lt;-</span> <span class="fu">colSums</span>((xcors_vals<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>nu<span class="sc">*</span><span class="fu">abs</span>(xcors_lags)))[<span class="dv">20</span><span class="sc">:</span><span class="dv">39</span>,])</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>corrint_ijl <span class="ot">&lt;-</span> <span class="fu">replace</span>(corrint_ijl, <span class="fu">is.nan</span>(corrint_ijl), <span class="dv">0</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>corrint_jil <span class="ot">&lt;-</span> <span class="fu">replace</span>(corrint_jil, <span class="fu">is.nan</span>(corrint_jil), <span class="dv">0</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="fu">matrix</span>(corrint_ijl, <span class="at">ncol =</span> <span class="dv">3</span>), <span class="at">las =</span> <span class="dv">1</span>, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Integral, i-&gt;j"</span>, <span class="at">col =</span> <span class="fu">hcl.colors</span>(<span class="dv">7</span>, <span class="st">"Blue-Red"</span>, <span class="at">rev=</span>T),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">zlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">range</span>(corrint_ijl))),<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">range</span>(corrint_ijl)))))</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="fu">matrix</span>(corrint_jil, <span class="at">ncol =</span> <span class="dv">3</span>), <span class="at">las =</span> <span class="dv">1</span>, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Integral, j-&gt;i"</span>, <span class="at">col =</span> <span class="fu">hcl.colors</span>(<span class="dv">7</span>, <span class="st">"Blue-Red"</span>, <span class="at">rev =</span> T),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">zlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">range</span>(corrint_jil))),<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">range</span>(corrint_jil)))))</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="fu">matrix</span>(corrint_ij, <span class="at">ncol =</span> <span class="dv">6</span>), <span class="at">las =</span> <span class="dv">1</span>, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Integral, i-&gt;j"</span>, <span class="at">col =</span> <span class="fu">hcl.colors</span>(<span class="dv">7</span>, <span class="st">"Blue-Red"</span>, <span class="at">rev=</span>T),</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">zlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">range</span>(corrint_ij))),<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">range</span>(corrint_ij)))))</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="fu">matrix</span>(corrint_ji, <span class="at">ncol =</span> <span class="dv">6</span>), <span class="at">las =</span> <span class="dv">1</span>, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Integral, j-&gt;i"</span>, <span class="at">col =</span> <span class="fu">hcl.colors</span>(<span class="dv">7</span>, <span class="st">"Blue-Red"</span>, <span class="at">rev =</span> T),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">zlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">range</span>(corrint_ji))),<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">range</span>(corrint_ji)))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="toy_implementation_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>foi_ijl <span class="ot">&lt;-</span> udprodl<span class="sc">/</span>nu<span class="sc">+</span>sdprodl<span class="sc">*</span>corrint_ijl</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>foi_jil <span class="ot">&lt;-</span> udprodl<span class="sc">/</span>nu<span class="sc">+</span>sdprodl<span class="sc">*</span>corrint_jil</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="fu">matrix</span>(foi_ijl, <span class="at">ncol =</span> <span class="dv">3</span>), <span class="at">las =</span> <span class="dv">1</span>, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Large cell FOI, i-&gt;j"</span>, <span class="at">zlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.01</span>))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="fu">matrix</span>(foi_jil, <span class="at">ncol =</span> <span class="dv">3</span>), <span class="at">las =</span> <span class="dv">1</span>, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Large cell FOI, j-&gt;i"</span>, <span class="at">zlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.01</span>))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="fu">matrix</span>(foi_ij, <span class="at">ncol =</span> <span class="dv">6</span>), <span class="at">las =</span> <span class="dv">1</span>, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Small cell FOI, i-&gt;j"</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="fu">matrix</span>(foi_ji, <span class="at">ncol =</span> <span class="dv">6</span>), <span class="at">las =</span> <span class="dv">1</span>, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Small FOI, j-&gt;i"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="toy_implementation_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Large cells FOI (i-&gt;j):"</span>,<span class="fu">sum</span>(foi_ijl[foi_ijl<span class="sc">&gt;=</span><span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Large cells FOI (i-&gt;j): 0.2060306</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Large cells FOI (j-&gt;i):"</span>,<span class="fu">sum</span>(foi_jil[foi_jil<span class="sc">&gt;=</span><span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Large cells FOI (j-&gt;i): 0.243767</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Small cells FOI (i-&gt;j):"</span>,<span class="fu">sum</span>(foi_ij[foi_ij<span class="sc">&gt;=</span><span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Small cells FOI (i-&gt;j): 0.04862688</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Small cells FOI (j-&gt;i):"</span>,<span class="fu">sum</span>(foi_ji[foi_ji<span class="sc">&gt;=</span><span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Small cells FOI (j-&gt;i): 0.06122299</code></pre>
</div>
</div>
<p>The FOI estimated for the smaller cells is usually smaller than with the larger cells. With larger cells we are increasing the probability of encounter, as well as the covariance. These values, however, may not be representative of the epidemiological dynamics. The correct way of dealing with this, I think is to use a grid based on a contact distance that represents the host-parasite system accurately. We could use a larger grid, but then when we sample the probabilities of encounter they may be higher artificially.</p>
<p>For the simulated tracks, and for real data, we need to force a grid using the threshold distance for the kernel density estimation. This approach may generate very large objects in memory.</p>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>